<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PDF Merger</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Phosphor Icons -->
  <script src="https://unpkg.com/@phosphor-icons/web@2.1.1/dist/phosphor.js"></script>
  <!-- PDF-lib -->
  <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f3f4f6;
    }
    .file-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background-color: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 0.5rem;
      padding: 0.75rem 1rem;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
      cursor: grab;
      transition: background-color 0.2s ease-in-out;
    }
    .file-item:hover {
      background-color: #f9fafb;
    }
    .file-item.dragging {
      opacity: 0.5;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .file-name {
      flex-grow: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
  <div class="bg-white rounded-xl shadow-2xl p-6 sm:p-8 w-full max-w-sm sm:max-w-lg">
    <h1 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-2 text-center">PDF Merger</h1>
    <p class="text-gray-500 mb-6 text-center text-sm sm:text-base">Drag and drop or select PDF files to merge them.</p>

    <!-- Drop Zone -->
    <div id="dropZone"
      class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer transition-colors duration-200 hover:border-blue-500"
      onclick="document.getElementById('fileInput').click()">
      <input type="file" id="fileInput" class="hidden" accept=".pdf" multiple>
      <i class="ph ph-file-pdf text-5xl sm:text-6xl text-gray-400 mb-2"></i>
      <p id="statusMessage" class="text-gray-500 text-sm sm:text-base">Please drag and drop PDF files here, or click to select them.</p>
    </div>

    <!-- File List -->
    <div id="fileList" class="mt-6 space-y-2 hidden max-h-64 overflow-y-auto"></div>

    <!-- Buttons -->
    <div class="mt-8 flex flex-col sm:flex-row sm:justify-between sm:space-x-4 space-y-3 sm:space-y-0">
      <button id="mergeBtn"
        class="w-full sm:w-auto px-6 py-3 bg-blue-600 text-white font-medium rounded-lg shadow-md hover:bg-blue-700 disabled:opacity-50"
        disabled>
        Merge PDFs
      </button>
      <a id="downloadLink"
        class="w-full sm:w-auto px-6 py-3 bg-green-600 text-white font-medium rounded-lg shadow-md hover:bg-green-700 hidden text-center"
        download="merged.pdf">
        Download
      </a>
      <button id="resetBtn"
        class="w-full sm:w-auto px-6 py-3 bg-gray-200 text-gray-700 rounded-lg shadow-sm hover:bg-gray-300 hidden">
        Reset
      </button>
    </div>
  </div>

  <script>
    const fileInput = document.getElementById('fileInput');
    const fileList = document.getElementById('fileList');
    const statusMessage = document.getElementById('statusMessage');
    const mergeBtn = document.getElementById('mergeBtn');
    const resetBtn = document.getElementById('resetBtn');
    const downloadLink = document.getElementById('downloadLink');
    const dropZone = document.getElementById('dropZone');

    let files = [];
    let draggedItem = null;

    function updateFileList() {
      fileList.innerHTML = '';
      if (files.length === 0) {
        fileList.classList.add('hidden');
        statusMessage.classList.remove('hidden');
        statusMessage.textContent = 'Please drag and drop PDF files here, or click to select them.';
        mergeBtn.disabled = true;
        resetBtn.classList.add('hidden');
        downloadLink.classList.add('hidden');
      } else {
        fileList.classList.remove('hidden');
        files.forEach((file, idx) => {
          const item = document.createElement('div');
          item.className = 'file-item';
          item.setAttribute('draggable', true);
          item.dataset.index = idx;
          item.innerHTML = `
            <div class="flex items-center space-x-2 overflow-hidden">
              <i class="ph ph-list-dashes text-gray-400 drag-handle"></i>
              <span class="file-name text-gray-800 text-sm sm:text-base">${file.name}</span>
            </div>
            <button 
              class="remove-file flex items-center justify-center w-8 h-8 rounded-full text-red-500 hover:bg-red-100 active:bg-red-200"
              data-index="${idx}">
              <i class="ph ph-x text-xl"></i>
            </button>
          `;
          fileList.appendChild(item);
        });
        statusMessage.classList.add('hidden');
        mergeBtn.disabled = false;
        resetBtn.classList.remove('hidden');
      }
    }

    fileInput.addEventListener('change', e => {
      files = Array.from(e.target.files).filter(f => f.type === 'application/pdf');
      updateFileList();
    });

    dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('border-blue-500'); });
    dropZone.addEventListener('dragleave', () => dropZone.classList.remove('border-blue-500'));
    dropZone.addEventListener('drop', e => {
      e.preventDefault(); dropZone.classList.remove('border-blue-500');
      const dropped = Array.from(e.dataTransfer.files).filter(f => f.type === 'application/pdf');
      files = [...files, ...dropped];
      updateFileList();
    });

    // Drag + reorder
    fileList.addEventListener('dragstart', e => {
      if (e.target.classList.contains('file-item')) {
        draggedItem = e.target;
        setTimeout(() => e.target.classList.add('dragging'), 0);
      }
    });
    fileList.addEventListener('dragend', e => {
      e.target.classList.remove('dragging');
      draggedItem = null;
      const newOrder = [];
      fileList.querySelectorAll('.file-item').forEach(el => {
        newOrder.push(files[parseInt(el.dataset.index)]);
      });
      files = newOrder;
      updateFileList();
    });
    // Desktop Drag Events (existing)
fileList.addEventListener('dragstart', e => {
  if (e.target.classList.contains('file-item')) {
    draggedItem = e.target;
    setTimeout(() => e.target.classList.add('dragging'), 0);
  }
});
fileList.addEventListener('dragend', e => {
  e.target.classList.remove('dragging');
  draggedItem = null;
  resyncFiles();
});
fileList.addEventListener('dragover', e => {
  e.preventDefault();
  const afterElement = getDragAfterElement(fileList, e.clientY);
  const current = document.querySelector('.dragging');
  if (afterElement == null) {
    fileList.appendChild(current);
  } else {
    fileList.insertBefore(current, afterElement);
  }
});

// ðŸ“± Mobile Touch Events
let touchDragging = null;

fileList.addEventListener('touchstart', e => {
  const target = e.target.closest('.file-item');
  if (!target) return;
  touchDragging = target;
  target.classList.add('dragging');
});

fileList.addEventListener('touchmove', e => {
  if (!touchDragging) return;
  e.preventDefault(); // prevent scrolling
  const touch = e.touches[0];
  const afterElement = getDragAfterElement(fileList, touch.clientY);
  if (afterElement == null) {
    fileList.appendChild(touchDragging);
  } else {
    fileList.insertBefore(touchDragging, afterElement);
  }
});

fileList.addEventListener('touchend', e => {
  if (!touchDragging) return;
  touchDragging.classList.remove('dragging');
  touchDragging = null;
  resyncFiles();
});

// Helper function to resync file array with DOM order
function resyncFiles() {
  const newOrder = [];
  fileList.querySelectorAll('.file-item').forEach(el => {
    newOrder.push(files[parseInt(el.dataset.index)]);
  });
  files = newOrder;
  updateFileList();
}

// Same helper as before
function getDragAfterElement(container, y) {
  const els = [...container.querySelectorAll('.file-item:not(.dragging)')];
  return els.reduce((closest, child) => {
    const box = child.getBoundingClientRect();
    const offset = y - box.top - box.height / 2;
    if (offset < 0 && offset > closest.offset) {
      return { offset, element: child };
    } else {
      return closest;
    }
  }, { offset: Number.NEGATIVE_INFINITY }).element;
}


    // Remove file
    fileList.addEventListener('click', e => {
      if (e.target.closest('.remove-file')) {
        const idx = e.target.closest('.remove-file').dataset.index;
        files.splice(idx,1);
        updateFileList();
      }
    });

    // Merge
    mergeBtn.addEventListener('click', async () => {
      if (files.length < 2) { alert("Select at least two PDFs"); return; }
      mergeBtn.disabled = true;
      statusMessage.classList.remove('hidden');
      statusMessage.textContent = 'Merging PDFs...';
      statusMessage.classList.add('text-blue-500');
      downloadLink.classList.add('hidden');
      try {
        const { PDFDocument } = PDFLib;
        const merged = await PDFDocument.create();
        for (const file of files) {
          const bytes = await file.arrayBuffer();
          const pdf = await PDFDocument.load(bytes);
          const pages = await merged.copyPages(pdf, pdf.getPageIndices());
          pages.forEach(p => merged.addPage(p));
        }
        const outBytes = await merged.save();
        const blob = new Blob([outBytes], { type: 'application/pdf' });
        const url = URL.createObjectURL(blob);
        downloadLink.href = url;
        downloadLink.classList.remove('hidden');
        statusMessage.textContent = 'PDFs merged successfully!';
        statusMessage.classList.remove('text-blue-500');
        statusMessage.classList.add('text-green-600');
      } catch(err) {
        statusMessage.textContent = 'Error: '+err.message;
        statusMessage.classList.remove('text-blue-500');
        statusMessage.classList.add('text-red-500');
      } finally {
        mergeBtn.disabled = false;
      }
    });

    // Reset
    resetBtn.addEventListener('click', () => {
      files = []; fileInput.value = ''; updateFileList();
    });

    updateFileList();
  </script>
</body>
</html>
